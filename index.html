<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Language Docs</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.1/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #111;
      color: white;
    }

    pre code {
      display: block;
      padding: 1rem;
      background-color: #1e1e1e;
      color: #d4d4d4;
      font-family: Consolas, monospace;
      border-radius: 0 0 0.5rem 0.5rem;
      overflow-x: auto;
    }

    .sidebar a.active {
      color: #3b82f6;
      font-weight: bold;
    }

    .sidebar a {
      display: block;
      padding: 0.5rem;
      border-radius: 0.375rem;
      transition: background-color 0.2s;
    }

    .sidebar a:hover {
      background-color: #2d2d2d;
    }

    .code-header {
      background-color: #333;
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 600;
      border-top-left-radius: 0.5rem;
      border-top-right-radius: 0.5rem;
    }

    .highlight-keyword {
      color: #569CD6;
    }

    .highlight-core {
      color: #4EC9B0;
    }

    .highlight-func {
      color: #DCDCAA;
    }
  </style>
</head>

<body>
  <div class="flex">
    <aside class="w-64 bg-gray-900 p-6 h-screen overflow-y-auto border-r border-gray-800 sidebar sticky top-0">
      <nav id="sidebar-nav" class="space-y-1"></nav>
    </aside>

    <main class="flex-1 p-8 doc-content" id="content"></main>
  </div>

  <script>
    const rawContent = `
# 1. Getting Started
## 1.1 Hello World
This is your first Lua script.

<LUA>$Print Hello$
local msg = \"Hello World\"
print(msg)
</LUA>

## 1.2 Variables
More on defining variables in Lua.

<LUA>$Variable Example$
local a = 5
local b = \"Hello\"
</LUA>

# 2. Functions
## 2.1 Basic Functions
How to define and use functions.

<LUA>$Simple Function$
function greet()
  print(\"Hi there!\")
end
greet()
</LUA>
`;

    const keywords = ['local', 'function', 'if', 'then', 'end', 'for', 'in', 'do', 'return'];
    const coreFunctions = ['Instance', 'print', 'pairs'];
    const userFunctions = ['greet'];

    function highlightLua(code) {
      keywords.forEach(k => {
        const regex = new RegExp(`\\b${k}\\b`, 'g');
        code = code.replace(regex, `<span class="highlight-keyword">${k}</span>`);
      });
      coreFunctions.forEach(fn => {
        const regex = new RegExp(`\\b${fn}\\b`, 'g');
        code = code.replace(regex, `<span class="highlight-core">${fn}</span>`);
      });
      userFunctions.forEach(fn => {
        const regex = new RegExp(`\\b${fn}\\b`, 'g');
        code = code.replace(regex, `<span class="highlight-func">${fn}</span>`);
      });
      return code;
    }

    function parseContent(raw) {
      const lines = raw.split('\n');
      const contentContainer = document.getElementById('content');
      const nav = document.getElementById('sidebar-nav');
      let html = '';
      let navHTML = '';
      let subIndex = 0;
      let lastCatId = '';

      lines.forEach(line => {
        if (line.startsWith('# ')) {
          const cat = line.slice(2).trim();
          const id = `cat-${subIndex++}`;
          navHTML += `<a href="#${id}" class="text-white font-semibold">${cat}</a>`;
          html += `<h1 id="${id}" class="text-2xl font-bold mt-8 mb-4">${cat}</h1>`;
          lastCatId = id;
        } else if (line.startsWith('## ')) {
          const sub = line.slice(3).trim();
          const id = `sub-${subIndex++}`;
          navHTML += `<a href="#${id}" class="ml-4 text-sm text-gray-300">${sub}</a>`;
          html += `<h2 id="${id}" class="text-xl font-semibold mt-6 mb-3">${sub}</h2>`;
        } else if (line.startsWith('<LUA>')) {
          const titleMatch = line.match(/<LUA>\\$(.*?)\\$/);
          if (titleMatch) {
            const blockTitle = titleMatch[1];
            html += `<div class="my-4"><div class="code-header">${blockTitle}</div><pre><code>`;
          } else {
            html += '<pre><code>';
          }
        } else if (line.startsWith('</LUA>')) {
          html += '</code></pre></div>';
        } else if (html.endsWith('<pre><code>')) {
          html += highlightLua(line) + '\\n';
        } else {
          html += `<p class="mb-4 text-gray-300">${line}</p>`;
        }
      });

      contentContainer.innerHTML = html;
      nav.innerHTML = navHTML;

      const links = nav.querySelectorAll('a');
      function updateActive() {
        let activeFound = false;
        links.forEach(link => {
          const section = document.getElementById(link.getAttribute('href').substring(1));
          if (!section) return;
          const rect = section.getBoundingClientRect();
          if (!activeFound && rect.top >= 0 && rect.top < window.innerHeight / 2) {
            links.forEach(l => l.classList.remove('active'));
            link.classList.add('active');
            activeFound = true;
          }
        });
      }

      window.addEventListener('scroll', updateActive);
      updateActive();
    }

    parseContent(rawContent);
  </script>
</body>

</html>
